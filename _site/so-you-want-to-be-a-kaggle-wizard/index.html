<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>So You Want to be a Kaggle Wizard &#8211; Kwyn Meagher</title> <meta name="description" content="BackgroundMy group at Hack Reactor decided for a short project we would attempt to tackle a Kaggle competition. Specifically the GalaxyZoo Kaggle competition. A daunting challenge considering 1. we are new to machine learning. 2. some of us are new to programming and 3. we only have two weeks to work on this specific project."> <meta name="keywords" content="machine learning, python, image processing"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="http://localhost:4000/images/blur07.jpg"> <meta name="twitter:title" content="So You Want to be a Kaggle Wizard"> <meta name="twitter:description" content="BackgroundMy group at Hack Reactor decided for a short project we would attempt to tackle a Kaggle competition. Specifically the GalaxyZoo Kaggle competition. A daunting challenge considering 1. we are new to machine learning. 2. some of us are new to programming and 3. we only have two weeks to work on this specific project."> <meta name="twitter:site" content="@HarleyKwyn"> <meta name="twitter:creator" content="@HarleyKwyn"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="So You Want to be a Kaggle Wizard"> <meta property="og:description" content="BackgroundMy group at Hack Reactor decided for a short project we would attempt to tackle a Kaggle competition. Specifically the GalaxyZoo Kaggle competition. A daunting challenge considering 1. we are new to machine learning. 2. some of us are new to programming and 3. we only have two weeks to work on this specific project."> <meta property="og:url" content="http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/"> <meta property="og:site_name" content="Kwyn Meagher"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Kwyn Meagher" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/blur07.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/Ledge.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/Leading.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">So You Want to be a Kaggle Wizard </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags.html#machine learning">machine learning</a></li> <li><a href="http://localhost:4000/tags.html#python">python</a></li> <li><a href="http://localhost:4000/tags.html#image processing">image processing</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts.html">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> &copy; 2017 <a href="https://plus.google.com/+KwynMeagher?rel=author"> Kwyn Alice Meagher </a>. </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <!-- <a title="projects" class="projects-menu-icon"> <span></span> </a> --> <div class="inner-post content"> <div class="date-highlight">27 Feb 2014</div> <h1 id="background">Background</h1> <p>My group at Hack Reactor decided for a short project we would attempt to tackle a Kaggle competition. Specifically the <a href="http://www.kaggle.com/c/galaxy-zoo-the-galaxy-challenge">GalaxyZoo Kaggle competition</a>. A daunting challenge considering 1. we are new to machine learning. 2. some of us are new to programming and 3. we only have two weeks to work on this specific project.</p> <p>Diving into researching and reading the forums we found some helpful information and actually found this <a href="http://www.kaggle.com/c/galaxy-zoo-the-galaxy-challenge/forums/t/6803/beating-the-benchmark">post</a>.</p> <p>After much effort trying to execute the supposed 20 minute solution referenced on the GalaxyZoo Kaggle competition forums I’ve decided to help complete newbies get up and running with python and the appropriate libraries to execute this solution.</p> <p><strong>If you want to cheat, you can jump down to the bottom of the page for the full code but it’d be better if you could try to follow along.</strong></p> <p><em>note: I this is designed for a Unix/MacOSX based setup</em></p> <h1 id="overview">Overview</h1> <p>According to the post for beating the benchmark:</p> <blockquote> <p>Step 1 : for all images in train and test, resize to 50x50, and vectorize to 1-D array.</p> <p>Step 2: Run the RandomForestRegression from scikit-learn on the train and test set with 10 estimators.</p> <p>Step 3: Submit Results</p> <p>Step 4: You have beaten the benchmark</p> </blockquote> <p>Problem with this is that that it assumes you know how to do all of this with a large set of data already. So I’m going to show you how to set up the environment for using Python, scikit-image and scikit-learn. You may want to check out the <a href="">scikit-image</a> and <a href="http://scikit-learn.org/stable/documentation.html">scikit-learn</a> documentation.</p> <h2 id="snake-charming-installing-anaconda">Snake Charming (Installing Anaconda)</h2> <p><a href="https://store.continuum.io/cshop/anaconda/">Anaconda</a> is an awesome python package that contains all of the awesome tools we’ll be using and many others. It’s simpler to run the graphic installer provided by Anaconda and following their instillations instruction rather than writing out all the install commands for every dependency. Be sure to install it for your current user.</p> <p>You should now be able to run the command <code class="highlighter-rouge">spyder</code> to open up a python editor.</p> <h1 id="step-1">Step 1.</h1> <h2 id="create-a-python-file">Create a python file</h2> <p>Get started by creating an empty python file named <code class="highlighter-rouge">MyFirstForest.py</code> and open it up in your favorite editor. If you don’t have one I suggest spyder as mentioned previously or <a href="http://www.sublimetext.com/">Sublime Text 2</a>.</p> <h2 id="getting-the-images">Getting the images</h2> <p>If you want to do this with the Kaggle competition data you can down load it <a href="http://www.kaggle.com/c/galaxy-zoo-the-galaxy-challenge/data">here</a> after you make an account and agree to the competition terms. You’ll want to download all of the files and extract them into you workspace directory. Unzipping the image files can take some time.</p> <p>The very first thing you’ll need to do is get a hold of the images which requires the <code class="highlighter-rouge">os</code> module to access the file system so start by typing</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span></code></pre></figure> <p>at the top of the file. This will import the os utility that allows us to access the file system and other parts of the operating system.</p> <p>Leave a bit of space and type the following code to actually loop through the <code class="highlighter-rouge">trainingImages</code> directory and read each of the images into a variable that we can manipulate.</p> <p>You’ll also need to initialize an empty list that will hold all our training features. I aptly named mine <code class="highlighter-rouge">trainingFeatures</code></p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#note that this path is absolute path to your training image directory</span>
<span class="n">pathToTrainingImages</span> <span class="o">=</span> <span class="s">'/Users/kwyn/workspace/images_training_rev1/'</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pathToTrainingImages</span><span class="p">):</span>   
    <span class="n">trainingFeatures</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">pathToTrainingImages</span> <span class="o">+</span> <span class="n">f</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span></code></pre></figure> <p><em>note that the path for this command is <a href="http://en.wikipedia.org/wiki/Path_(computing\)#Example">absolute</a></em></p> <h2 id="resize-the-images">Resize the images</h2> <p>Awesome, so we have our image, but we need to still resize it and we also need to flatten it into a 1D array, where every pixel’s RGB value is an element in the array.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">resize</span></code></pre></figure> <p>This will import the transform.resize utility from the scikit-image library that will allow us to resize the image.</p> <p>Place the following command after <code class="highlighter-rouge">img = io.imread(filePath)</code></p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">img</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span></code></pre></figure> <h2 id="convert-the-images-into-a-list">Convert the images into a list</h2> <p>So first we’ll need a list to store our feature lists in. An array of arrays for those of you who don’t speak python. You’ll pick up on it soon enough.</p> <p>Then after the <code class="highlighter-rouge">img = resize(img, (50,50))</code> you’ll want to include the following line to convert the image to a numpy array:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">arrayOfImage</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code></pre></figure> <h1 id="flatten-the-image-list">Flatten the image list</h1> <p>This isn’t a flattened array though so we need to also flatten this. With python we have handy list comprehensions that will let us do this with single line using the following code:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">flattenedArrayOfImage</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arrayOfImage</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span></code></pre></figure> <p>and lastly append this to the an array you’ll save to run the your algorithms on later with the following line of code:</p> <p>We need to hoist a variable for to store each of these arrays as an array of features that we will feed into our random forest.</p> <p>So right after the line</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pathToTrainingImages</span><span class="p">):</span></code></pre></figure> <p>You’ll include this line of code:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">trainingFeatures</span> <span class="o">=</span> <span class="p">[]</span></code></pre></figure> <h2 id="convert-list-to-a-numpy-array">Convert list to a numpy array</h2> <p>scikit-learn methods use the numpy library so we can’t feed it a list we must first convert the tuple list we have just created into a numpy array. To do that we need to have import the numpy feature and alias it to something pretty like <code class="highlighter-rouge">np</code>. You want to do that by including the that with the following line after the the imports :</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span></code></pre></figure> <p>and then make sure you write the next line of code out of the loop, to do this you have to make sure that you are not indented at all as python is white space sensitive and then include the following line to convert the list to a numpy array:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">trainingFeature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trainingFeatures</span><span class="p">)</span></code></pre></figure> <p>You should have something that looks like this:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">color</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">resize</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">print</span> <span class="s">"opening training images"</span>

<span class="n">pathToTrainingImages</span> <span class="o">=</span> <span class="s">'/Users/kwyn/workspace/images_training_rev1/'</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pathToTrainingImages</span><span class="p">):</span>   
    <span class="n">trainingFeatures</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">pathToTrainingImages</span> <span class="o">+</span> <span class="n">f</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">colorconv</span><span class="o">.</span><span class="n">rgb2grey</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">arrayOfImage</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">flattenedArrayOfImage</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arrayOfImage</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">trainingFeatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flattenedArrayOfImage</span><span class="p">)</span>

<span class="n">trainingFeatures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trainingFeatures</span><span class="p">)</span></code></pre></figure> <p>You’ll have to repeat this code for the testing data. Just adjust the path name and the variable names for the <code class="highlighter-rouge">trainingFeatures</code> list to something like <code class="highlighter-rouge">testingFeatures</code></p> <p>We’re about half way there, keep going!</p> <h1 id="step-2">Step 2.</h1> <h2 id="load-the-training-data">Load the training data</h2> <p>The training data is given to us in a <code class="highlighter-rouge">.csv</code> format. We can use a numpy module that to read the data directly into a numpy array with <code class="highlighter-rouge">np.loadtxt</code> which you can read up on in the numpy documentation for <a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.loadtxt.html">loadtxt</a></p> <p>This following code will load the csv data into a numpy array:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">pathToTrainingData</span> <span class="o">=</span> <span class="s">"/Users/kwyn/workspace/training_solutions_rev1.csv"</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathToTrainingData</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">numColumns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">))</span>
<span class="n">trainingSolutions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">pathToTrainingData</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numColumns</span><span class="p">))</span></code></pre></figure> <p>We aren’t interested in the header of the data being included in our numpy array so we remove that and we also exclude the the first columns with the galaxy IDs.</p> <h2 id="train-the-algorithm">Train the algorithm</h2> <p>Time for the exciting part! Using scikit-learn to train a random forest on the data. We’ll first need to include the scikit-learn module for random forest regressors. You can do that by including the following with your import commands at the top of the file.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span></code></pre></figure> <p>If your interested in delving into what all the parameters mean you can check the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">sckit-learn documentation</a></p> <p>Then after all the previous code we will append the following code to actually train our algorithm.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">rfr</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rfr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingFeatures</span><span class="p">,</span> <span class="n">trainingSolutions</span><span class="p">)</span></code></pre></figure> <p>Once this successfully runs then you’ll have a trained algorithm!</p> <h2 id="saving-your-algorithm-with-joblib">Saving your algorithm with joblib</h2> <p>One more module that you will most likely want to exploit is called <code class="highlighter-rouge">joblib</code> it allows us to directly save python objects and use them later after the script has finished running. In a later post I’ll explain the difference between using this and pickling that is frequently used in python code. You can read more about the module <a href="http://pythonhosted.org//joblib/">here</a></p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.externals</span> <span class="kn">import</span> <span class="n">joblib</span></code></pre></figure> <p>Then right after the lines that train your algorithm write the following code setting the path to a file you wish to save your algorithm in I chose <code class="highlighter-rouge">Algorithms</code> for mine</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">algorithmName</span> <span class="o">=</span> <span class="s">"myFirstForest"</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rfr</span><span class="p">,</span> <span class="s">'Algorthims'</span><span class="p">)</span></code></pre></figure> <p>As you iterate over different parameters and changing features in the future you’ll probably change the name in of the <code class="highlighter-rouge">algorithmName</code> variable.</p> <p><em>Be sure to create this the Algorithms folder before running the python script</em></p> <h1 id="running-the-produced-algorithm-on-the-test-data">Running the produced algorithm on the test data</h1> <p>This part is also easy. Just make sure to use joblib to save your prediction somewhere just in case writing to CSV doesn’t go as planned.</p> <p>Include the following code:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">prediction</span> <span class="o">=</span> <span class="n">rfr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testingFeatures</span><span class="p">)</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="s">'Solutions/firstPrediction'</span><span class="p">)</span></code></pre></figure> <h1 id="step-3">Step 3.</h1> <h2 id="formatting-the-prediction-data-for-submission">Formatting the prediction data for submission</h2> <p>The Kaggle competition expects the csv to be exported in a specific format so so that the tester they have can read the file correctly and perform the error calculations. For this we use numpy’s <code class="highlighter-rouge">.savetxt</code> method. If you want to know more about how this works you can read up on numpys documentation for <a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.savetxt.html">savetxt</a></p> <p>For now just copy this code after your predictions have been made</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">galaxyIDs</span> <span class="o">=</span> <span class="n">galaxyIDs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">galaxyIDs</span><span class="p">,</span> <span class="n">prediction</span><span class="p">))</span>
<span class="n">headerRow</span> <span class="o">=</span> <span class="s">'GalaxyID,Class1.1,Class1.2,Class1.3,Class2.1,Class2.2,Class3.1,Class3.2,Class4.1,Class4.2,Class5.1,Class5.2,Class5.3,Class5.4,Class6.1,Class6.2,Class7.1,Class7.2,Class7.3,Class8.1,Class8.2,Class8.3,Class8.4,Class8.5,Class8.6,Class8.7,Class9.1,Class9.2,Class9.3,Class10.1,Class10.2,Class10.3,Class11.1,Class11.2,Class11.3,Class11.4,Class11.5,Class11.6'</span>
<span class="n">formatting</span> <span class="o">=</span> <span class="s">'</span><span class="si">%</span><span class="s">d,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f'</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">'Predictions/firstPrediction.csv'</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">formatting</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">headerRow</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">''</span><span class="p">)</span></code></pre></figure> <p>Submit the output file in the Solutions folder to the competition.</p> <h1 id="step-4">Step 4.</h1> <h2 id="tada-youve-beaten-the-bench-mark">Ta’da you’ve beaten the bench mark</h2> <p>Hope this has helped those of you new to python and machine learning. If you’re clever you’ll start experimenting with the scikit-learn morphology library and tweaking features.</p> <h1 id="complete-code">Complete Code</h1> <p>Your code should look something like this:</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">color</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">resize</span>
<span class="kn">from</span> <span class="nn">sklearn.externals</span> <span class="kn">import</span> <span class="n">joblib</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>

<span class="k">print</span> <span class="s">"Opening training images"</span>

<span class="n">pathToTrainingImages</span> <span class="o">=</span> <span class="s">'/Users/kwyn/workspace/images_training_rev1/'</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pathToTrainingImages</span><span class="p">):</span>   
    <span class="n">trainingFeatures</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">pathToTrainingImages</span> <span class="o">+</span> <span class="n">f</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">colorconv</span><span class="o">.</span><span class="n">rgb2grey</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">arrayOfImage</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">flattenedArrayOfImage</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arrayOfImage</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">trainingFeatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flattenedArrayOfImage</span><span class="p">)</span>

<span class="n">trainingFeatures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trainingFeatures</span><span class="p">)</span>

<span class="k">print</span> <span class="n">trainingFeatures</span>

<span class="k">print</span> <span class="s">"Finished converting training images to numpy arrays"</span>
<span class="k">print</span> <span class="s">"Opening test images"</span>

<span class="n">pathToTestingImages</span> <span class="o">=</span> <span class="s">"/Users/kwyn/workspace/images_test_rev1/"</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">pathToTestingImages</span><span class="p">):</span>
    <span class="n">testingFeatures</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">galaxyIDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">pathToTestingImages</span> <span class="o">+</span> <span class="n">f</span>
        <span class="n">galaxyIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="n">galaxyIDs</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">colorconv</span><span class="o">.</span><span class="n">rgb2grey</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">arrayOfImage</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">flattenedArrayOfImage</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arrayOfImage</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">testingFeatures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flattenedArrayOfImage</span><span class="p">)</span>

<span class="n">testingFeatures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">testingFeatures</span><span class="p">)</span>
<span class="n">galaxyIDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">galaxyIDs</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Finished converting test images to numpy array."</span>
<span class="k">print</span> <span class="s">"Opening training data..."</span>

<span class="n">pathToTrainingData</span> <span class="o">=</span> <span class="s">"/Users/kwyn/workspace/training_solutions_rev1.csv"</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathToTrainingData</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">numColumns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">))</span>
<span class="n">trainingSolutions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">pathToTrainingData</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numColumns</span><span class="p">))</span>

<span class="k">print</span> <span class="n">trainingSolutions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">print</span> <span class="s">"Finished loading training data"</span>  
<span class="k">print</span> <span class="s">"starting random forest training"</span>

<span class="n">rfr</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">oob_score</span><span class="o">=</span><span class="s">"true"</span><span class="p">)</span>
<span class="n">rfr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingFeatures</span><span class="p">,</span> <span class="n">trainingSolutions</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Finished random forest training"</span>
<span class="k">print</span> <span class="s">"Saving algorithm"</span>

<span class="n">algorithmName</span> <span class="o">=</span> <span class="s">"myFirstForest"</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rfr</span><span class="p">,</span> <span class="s">'Algorthims/'</span><span class="o">+</span><span class="n">algorithmName</span> <span class="p">)</span>

<span class="k">print</span> <span class="s">"starting testing..."</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">rfr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testingFeatures</span><span class="p">)</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="s">'Solutions/firstPrediction'</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"finished testing"</span>
<span class="k">print</span> <span class="s">"writing predictions to csv"</span>

<span class="n">galaxyIDs</span> <span class="o">=</span> <span class="n">galaxyIDs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">galaxyIDs</span><span class="p">,</span> <span class="n">prediction</span><span class="p">))</span>
<span class="n">headerRow</span> <span class="o">=</span> <span class="s">'GalaxyID,Class1.1,Class1.2,Class1.3,Class2.1,Class2.2,Class3.1,Class3.2,Class4.1,Class4.2,Class5.1,Class5.2,Class5.3,Class5.4,Class6.1,Class6.2,Class7.1,Class7.2,Class7.3,Class8.1,Class8.2,Class8.3,Class8.4,Class8.5,Class8.6,Class8.7,Class9.1,Class9.2,Class9.3,Class10.1,Class10.2,Class10.3,Class11.1,Class11.2,Class11.3,Class11.4,Class11.5,Class11.6'</span>
<span class="n">formatting</span> <span class="o">=</span> <span class="s">'</span><span class="si">%</span><span class="s">d,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f,</span><span class="si">%</span><span class="s">f'</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">'Predictions/firstPrediction.csv'</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">formatting</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">headerRow</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"finished you can find you predictions in Predictions folder"</span></code></pre></figure> <br> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/so-you-want-to-be-a-kaggle-wizard/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> &copy; 2017 <a href="https://plus.google.com/+KwynMeagher?rel=author"> Kwyn Alice Meagher </a>. <nav class="pagination"> <a href="http://localhost:4000/machine-learning-work-flow/" class="pagination_pager" title="Machine Learning Work Flow for Hackers ">previous</a> <a href="http://localhost:4000/chrome-devtools-extensions-hello-world/" class="pagination_pager" title="Hello World App for Chrome Devtools Extensions ">next</a> </nav> <div id="comments"></div> <script> window.onLoadCallback = function() { gapi.comments.render('comments', { href: window.location, width: '624', first_party_property: 'BLOGGER', view_type: 'FILTERED_POSTMOD' }); } </script> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <script> // Defines the configuration options, these must be set before you load // the platform.js file. window.___gcfg = { lang: 'en-US', parsetags: 'explicit' // DS?: can the onload param be removed from the line below and added here? // E.g., 'explicit','onload' } </script> <script src="https://apis.google.com/js/platform.js" async defer></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
